{% extends "base.html" %}

{% block title %}–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="hero bg-gradient-to-r from-secondary to-accent text-primary-content rounded-lg mb-8">
        <div class="hero-content text-center">
            <div class="max-w-md">
                <h1 class="text-4xl font-bold mb-4">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã</h1>
                <p class="text-lg opacity-90">–î–µ–±–µ—Ç–æ–≤—ã–µ –∏ –∫—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã —Å –∫—ç—à–±—ç–∫–æ–º –∏ –±–æ–Ω—É—Å–Ω—ã–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏</p>
                <div class="badge badge-lg badge-accent mt-4">–î–æ 5% –∫—ç—à–±—ç–∫</div>
            </div>
        </div>
    </div>

    <!-- –¢–∏–ø—ã –∫–∞—Ä—Ç -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <!-- –î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-primary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                    –î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞
                </h2>
                <p class="text-base-content/70">–û–ø–ª–∞—á–∏–≤–∞–π—Ç–µ –ø–æ–∫—É–ø–∫–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏</p>
                <div class="stats stats-vertical shadow">
                    <div class="stat">
                        <div class="stat-title">–ö—ç—à–±—ç–∫ –¥–æ</div>
                        <div class="stat-value text-primary">5%</div>
                        <div class="stat-desc">–Ω–∞ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</div>
                        <div class="stat-value text-secondary">0 ‚ÇΩ</div>
                        <div class="stat-desc">–≤ –≥–æ–¥</div>
                    </div>
                </div>
                <div class="card-actions justify-end">
                    <button class="btn btn-primary" onclick="openCardModal('debit')">–û—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                </div>
            </div>
        </div>

        <!-- –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-secondary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞
                </h2>
                <p class="text-base-content/70">–ü–æ–∫—É–ø–∞–π—Ç–µ —Å–µ–π—á–∞—Å, –ø–ª–∞—Ç–∏—Ç–µ –ø–æ—Ç–æ–º</p>
                <div class="stats stats-vertical shadow">
                    <div class="stat">
                        <div class="stat-title">–õ–∏–º–∏—Ç –¥–æ</div>
                        <div class="stat-value text-primary">500 000 ‚ÇΩ</div>
                        <div class="stat-desc">–Ω–∞ –∫–∞—Ä—Ç–µ</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">–õ—å–≥–æ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>
                        <div class="stat-value text-secondary">55</div>
                        <div class="stat-desc">–¥–Ω–µ–π</div>
                    </div>
                </div>
                <div class="card-actions justify-end">
                    <button class="btn btn-secondary" onclick="openCardModal('credit')">–û—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–º–∏—É–º –∫–∞—Ä—Ç–∞ -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-accent">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                    </svg>
                    –ü—Ä–µ–º–∏—É–º –∫–∞—Ä—Ç–∞
                </h2>
                <p class="text-base-content/70">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã</p>
                <div class="stats stats-vertical shadow">
                    <div class="stat">
                        <div class="stat-title">–ö—ç—à–±—ç–∫ –¥–æ</div>
                        <div class="stat-value text-primary">7%</div>
                        <div class="stat-desc">–Ω–∞ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏</div>
                        <div class="stat-value text-secondary">VIP</div>
                        <div class="stat-desc">—Å–µ—Ä–≤–∏—Å</div>
                    </div>
                </div>
                <div class="card-actions justify-end">
                    <button class="btn btn-accent" onclick="openCardModal('premium')">–û—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–∏ –∫–∞—Ä—Ç—ã -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                </svg>
                –ú–æ–∏ –∫–∞—Ä—Ç—ã
            </h2>
            
            {% if cards %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for card in cards %}
                <div class="card bg-gradient-to-br from-primary to-secondary text-primary-content shadow-xl {% if card == primary_card %}ring-4 ring-yellow-400 ring-opacity-75 border-2 border-yellow-400{% endif %}">
                    <div class="card-body">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="card-title text-lg">
                                    {% if card.card_type == 'debit' %}–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞
                                    {% elif card.card_type == 'credit' %}–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞
                                    {% endif %}
                                </h3>
                                <p class="text-sm opacity-90">{{ card.client.full_name }}</p>
                                {% if card == primary_card %}
                                    <div class="badge badge-warning badge-sm mt-1 gap-1">
                                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                        </svg>
                                        –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–∞
                                    </div>
                                {% endif %}
                            </div>
                            <div class="badge badge-outline">{{ card.card_number|slice:"-4:" }}</div>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-2xl font-mono tracking-wider">{{ card.card_number }}</p>
                            <p class="text-sm opacity-90">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: {{ card.expiry_date|date:"m/Y" }}</p>
                            <p class="text-lg font-bold mt-2">–ë–∞–ª–∞–Ω—Å: {{ card.balance|floatformat:2 }} ‚ÇΩ</p>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                {% if card.is_active %}
                                    <span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω–∞</span>
                                {% else %}
                                    <span class="badge badge-error">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞</span>
                                {% endif %}
                            </div>
                            <div class="card-actions">
                                {% if card != primary_card and card.is_active %}
                                    <button
                                        class="btn btn-sm btn-accent"
                                        onclick="setPrimaryCard({{ card.id }})"
                                        title="–ù–∞–∑–Ω–∞—á–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç–æ–π"
                                    >
                                        –ù–∞–∑–Ω–∞—á–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π
                                    </button>
                                {% elif card == primary_card %}
                                    <span class="badge badge-success badge-lg">–û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</span>
                                {% endif %}
                                <button 
                                    class="btn btn-sm btn-primary"
                                    onclick="openManageCardModal(this)"
                                    data-card-id="{{ card.id }}"
                                    data-card-type="{{ card.card_type }}"
                                    data-card-number="{{ card.card_number }}"
                                    data-expiry="{{ card.expiry_date|date:"m/Y" }}"
                                    data-active="{% if card.is_active %}1{% else %}0{% endif %}"
                                    data-balance="{{ card.balance }}"
                                >–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8">
                <svg class="w-16 h-16 mx-auto text-base-content/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                </svg>
                <h3 class="text-xl font-semibold mb-2">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ä—Ç</h3>
                <p class="text-base-content/70 mb-4">–û—Ñ–æ—Ä–º–∏—Ç–µ –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç—É –¥–ª—è —É–¥–æ–±–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</p>
                <button class="btn btn-primary" onclick="openCardModal('debit')">–û—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É</button>
            </div>
            {% endif %}
        </div>
    </div>

    

    <!-- –ë–æ–Ω—É—Å—ã –∏ –∫—ç—à–±—ç–∫ -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                </svg>
                –ë–æ–Ω—É—Å—ã –∏ –∫—ç—à–±—ç–∫
            </h2>
            <div class="stats stats-vertical shadow">
                <div class="stat">
                    <div class="stat-title">–ù–∞–∫–æ–ø–ª–µ–Ω–æ –∫—ç—à–±—ç–∫–∞</div>
                    <div class="stat-value text-primary">1 250 ‚ÇΩ</div>
                    <div class="stat-desc">–∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</div>
                </div>
                <div class="stat">
                    <div class="stat-title">–ë–æ–Ω—É—Å–Ω—ã—Ö –±–∞–ª–ª–æ–≤</div>
                    <div class="stat-value text-secondary">15 600</div>
                    <div class="stat-desc">–¥–æ—Å—Ç—É–ø–Ω–æ –∫ —Å–ø–∏—Å–∞–Ω–∏—é</div>
                </div>
                <div class="stat">
                    <div class="stat-title">–°–ª–µ–¥—É—é—â–∏–π –∫—ç—à–±—ç–∫</div>
                    <div class="stat-value text-accent">5%</div>
                    <div class="stat-desc">–Ω–∞ –ø–æ–∫—É–ø–∫–∏ –≤ —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–∞—Ö</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-6">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞—à–∏—Ö –∫–∞—Ä—Ç</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-3xl mb-2">üí∞</div>
                    <h3 class="font-semibold mb-1">–ö—ç—à–±—ç–∫</h3>
                    <p class="text-sm text-base-content/70">–î–æ 5% –Ω–∞ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏</p>
                </div>
                <div class="text-center">
                    <div class="text-3xl mb-2">üîí</div>
                    <h3 class="font-semibold mb-1">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                    <p class="text-sm text-base-content/70">3D Secure, SMS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
                </div>
                <div class="text-center">
                    <div class="text-3xl mb-2">üì±</div>
                    <h3 class="font-semibold mb-1">–ú–æ–±–∏–ª—å–Ω—ã–π –±–∞–Ω–∫</h3>
                    <p class="text-sm text-base-content/70">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</p>
                </div>
                <div class="text-center">
                    <div class="text-3xl mb-2">üåç</div>
                    <h3 class="font-semibold mb-1">–ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ–∑–¥–µ</h3>
                    <p class="text-sm text-base-content/70">Visa, Mastercard</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã -->
<div id="cardModal" class="modal">
    <div class="modal-box max-w-4xl">
        <h3 class="font-bold text-xl mb-2" id="cardModalTitle">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã</h3>
        <p class="text-base-content/70 mb-6">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–∞—Ä—Ç—ã –∏ –ø—Ä–∏–≤—è–∂–∏—Ç–µ –µ–µ –∫ –æ–¥–Ω–æ–º—É –∏–∑ –≤–∞—à–∏—Ö —Å—á–µ—Ç–æ–≤</p>
        <form id="cardForm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- –ü—Ä–µ–≤—å—é –∫–∞—Ä—Ç—ã -->
                <div>
                    <div class="card bg-gradient-to-br from-primary to-secondary text-primary-content shadow-xl">
                        <div class="card-body">
                            <div class="flex justify-between items-center mb-2">
                                <span class="badge badge-outline badge-lg" id="previewCardType">–î–µ–±–µ—Ç–æ–≤–∞—è</span>
                                <span class="badge">VISA</span>
                            </div>
                            <div class="mt-4 mb-6">
                                <p class="text-2xl font-mono tracking-wider" id="previewCardNumber">0000 0000 0000 0000</p>
                                <p class="text-sm opacity-90">–°—Ä–æ–∫: <span id="previewExpiry">MM/YY</span></p>
                            </div>
                            <div class="flex justify-between items-end">
                                <div>
                                    <p class="text-xs opacity-70">–î–µ—Ä–∂–∞—Ç–µ–ª—å</p>
                                    <p class="font-semibold">{{ client.full_name }}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-xs opacity-70">–°—á–µ—Ç</p>
                                    <p class="font-mono" id="previewAccount">‚Äî</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 grid grid-cols-3 gap-2">
                        <div class="stat shadow">
                            <div class="stat-title">–ö—ç—à–±—ç–∫</div>
                            <div class="stat-value text-primary">5%</div>
                            <div class="stat-desc">–Ω–∞ –ø–æ–∫—É–ø–∫–∏</div>
                        </div>
                        <div class="stat shadow">
                            <div class="stat-title">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</div>
                            <div class="stat-value text-secondary">0 ‚ÇΩ</div>
                            <div class="stat-desc">–≤ –≥–æ–¥</div>
                        </div>
                        <div class="stat shadow">
                            <div class="stat-title">–õ–∏–º–∏—Ç</div>
                            <div class="stat-value">100k</div>
                            <div class="stat-desc">–≤ –¥–µ–Ω—å</div>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–ª—è —Ñ–æ—Ä–º—ã -->
                <div>
                    <div class="form-control mb-5">
                        <label class="label"><span class="label-text">–¢–∏–ø –∫–∞—Ä—Ç—ã</span></label>
                        <div class="join join-horizontal w-full">
                            <input class="btn join-item" type="radio" name="card_type" value="debit" aria-label="–î–µ–±–µ—Ç–æ–≤–∞—è" checked>
                            <input class="btn join-item" type="radio" name="card_type" value="credit" aria-label="–ö—Ä–µ–¥–∏—Ç–Ω–∞—è">
                        </div>
                        <label class="label"><span class="label-text-alt">–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π</span></label>
                    </div>

                    <div class="form-control mb-5">
                        <label class="label"><span class="label-text">–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–∞ –∫–∞—Ä—Ç–µ</span></label>
                        <input id="initialAmountRange" type="range" min="0" max="1000000" step="1000" value="0" class="range range-primary" name="initial_amount">
                        <div class="flex justify-between text-sm px-2 mt-2">
                            <span class="text-gray-500">0 ‚ÇΩ</span>
                            <span class="font-bold text-primary text-lg" id="initialAmountValue">0 ‚ÇΩ</span>
                            <span class="text-gray-500">1 000 000 ‚ÇΩ</span>
                        </div>
                        <label class="label"><span class="label-text-alt">–°—É–º–º–∞ –±—É–¥–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω–∞ –Ω–∞ –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏</span></label>
                    </div>

                    <!-- –ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã -->
                    <div id="creditInitialWrap" class="form-control mb-5 hidden">
                        <label class="label"><span class="label-text">–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç–µ</span></label>
                        <input id="creditInitialRange" type="range" min="0" max="1000000" step="1000" value="0" class="range range-primary" name="credit_initial">
                        <div class="flex justify-between text-sm px-2 mt-2">
                            <span class="text-gray-500">0 ‚ÇΩ</span>
                            <span class="font-bold text-primary text-lg" id="creditInitialValue">0 ‚ÇΩ</span>
                            <span class="text-gray-500">1 000 000 ‚ÇΩ</span>
                        </div>
                        <label class="label"><span class="label-text-alt">–ë—É–¥–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω–∞ –Ω–∞ –Ω–æ–≤—É—é –∫—Ä–µ–¥–∏—Ç–Ω—É—é –∫–∞—Ä—Ç—É</span></label>
                    </div>

                    <div class="form-control mb-5">
                        <label class="label"><span class="label-text">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</span></label>
                        <div class="filter w-full">
                            <input class="btn" type="radio" name="delivery" value="office" aria-label="–í –æ—Ñ–∏—Å" required>
                            <input class="btn" type="radio" name="delivery" value="courier" aria-label="–ö—É—Ä—å–µ—Ä–æ–º">
                            <input class="btn" type="radio" name="delivery" value="post" aria-label="–ü–æ—á—Ç–æ–π">
                        </div>
                    </div>

                    <label class="floating-label mb-6">
                        <textarea class="textarea" name="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" required></textarea>
                        <span>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</span>
                    </label>

                    <div class="flex items-center justify-end gap-2">
                        <button type="button" class="btn btn-ghost" onclick="closeCardModal()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–û—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ–π -->
<div id="manageCardModal" class="modal">
    <div class="modal-box max-w-3xl">
        <h3 class="font-bold text-xl mb-2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ–π</h3>
        <p class="text-base-content/70 mb-4">–î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–µ</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <div class="card bg-gradient-to-br from-primary to-secondary text-primary-content shadow-xl">
                    <div class="card-body">
                        <div class="flex justify-between items-center mb-2">
                            <span class="badge badge-outline" id="mCardType"></span>
                            <span class="badge" id="mCardStatus"></span>
                        </div>
                        <div class="mt-4 mb-6">
                            <p class="text-2xl font-mono tracking-wider" id="mCardNumber"></p>
                            <p class="text-sm opacity-90">–°—Ä–æ–∫: <span id="mCardExpiry"></span></p>
                        </div>
                        <div class="flex justify-between items-end">
                            <div>
                                <p class="text-xs opacity-70">–î–µ—Ä–∂–∞—Ç–µ–ª—å</p>
                                <p class="font-semibold">{{ client.full_name }}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs opacity-70">–°—á–µ—Ç</p>
                                <p class="font-mono" id="mCardAccount"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div class="space-y-4">
                    <div class="card bg-base-100 shadow">
                        <div class="card-body">
                            <h4 class="card-title text-base">–°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç—ã</h4>
                            <p class="text-sm text-base-content/70">–ë–ª–æ–∫–∏—Ä—É–π—Ç–µ –∫–∞—Ä—Ç—É –ø—Ä–∏ —É—Ç–µ—Ä–µ –∏–ª–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                            <div>
                                <button id="mBlockBtn" class="btn btn-error hidden" onclick="blockUnblockCard('block')">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button id="mUnblockBtn" class="btn btn-success hidden" onclick="blockUnblockCard('unblock')">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-base-100 shadow">
                        <div class="card-body">
                            <h4 class="card-title text-base">–°–º–µ–Ω–∞ PIN-–∫–æ–¥–∞</h4>
                            <p class="text-sm text-base-content/70">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π PIN (4 —Ü–∏—Ñ—Ä—ã)</p>
                            <div class="join">
                                <input id="mPinInput" type="password" maxlength="4" pattern="[0-9]{4}" class="input input-bordered join-item w-32" placeholder="0000">
                                <button class="btn btn-warning join-item" onclick="changeSelectedCardPin()">–°–º–µ–Ω–∏—Ç—å PIN</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-action">
            <button class="btn btn-ghost" onclick="closeManageCardModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<script>
// CSRF helper
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
}

let SELECTED_CARD_ID = null;

function openManageCardModal(el) {
    SELECTED_CARD_ID = el.dataset.cardId;
    document.getElementById('mCardType').textContent = el.dataset.cardType === 'credit' ? '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è' : '–î–µ–±–µ—Ç–æ–≤–∞—è';
    document.getElementById('mCardNumber').textContent = el.dataset.cardNumber;
    document.getElementById('mCardExpiry').textContent = el.dataset.expiry;
    document.getElementById('mCardAccount').textContent = el.dataset.account;

    const isActive = el.dataset.active === '1';
    document.getElementById('mCardStatus').textContent = isActive ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞';
    document.getElementById('mCardStatus').className = 'badge ' + (isActive ? 'badge-success' : 'badge-error');

    document.getElementById('mBlockBtn').classList.toggle('hidden', !isActive);
    document.getElementById('mUnblockBtn').classList.toggle('hidden', isActive);

    document.getElementById('manageCardModal').classList.add('modal-open');
}

function closeManageCardModal() {
    document.getElementById('manageCardModal').classList.remove('modal-open');
}

async function blockUnblockCard(action) {
    if (!SELECTED_CARD_ID) return;
    const csrfToken = getCookie('csrftoken');
    const endpoint = action === 'block' ? `/card/${SELECTED_CARD_ID}/block/` : `/card/${SELECTED_CARD_ID}/unblock/`;
    try {
        const resp = await fetch(endpoint, {
            method: 'POST',
            headers: { 'X-CSRFToken': csrfToken }
        });
        const data = await resp.json();
        if (data.success) {
            showAlert(action === 'block' ? '–ö–∞—Ä—Ç–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' : '–ö–∞—Ä—Ç–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞', 'success');
            window.location.reload();
        } else {
            showAlert(data.error || '–û—à–∏–±–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏', 'error');
        }
    } catch (e) {
        showAlert('–°–±–æ–π —Å–µ—Ç–∏', 'error');
    }
}

async function changeSelectedCardPin() {
    if (!SELECTED_CARD_ID) return;
    const pin = (document.getElementById('mPinInput').value || '').trim();
    if (!(pin.length === 4 && /^\d{4}$/.test(pin))) {
        showAlert('PIN –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑ 4 —Ü–∏—Ñ—Ä', 'warning');
        return;
    }
    const csrfToken = getCookie('csrftoken');
    try {
        const resp = await fetch(`/card/${SELECTED_CARD_ID}/pin/`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken },
            body: JSON.stringify({ new_pin: pin })
        });
        const data = await resp.json();
        if (data.success) {
            showAlert('PIN —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω', 'success');
            document.getElementById('mPinInput').value = '';
        } else {
            showAlert(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ PIN', 'error');
        }
    } catch (e) {
        showAlert('–°–±–æ–π —Å–µ—Ç–∏', 'error');
    }
}
function openCardModal(type) {
    const modal = document.getElementById('cardModal');
    const title = document.getElementById('cardModalTitle');
    const typeBadge = document.getElementById('previewCardType');
    const typeInputs = document.querySelectorAll('input[name="card_type"]');
    
    switch(type) {
        case 'debit':
            title.textContent = '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–µ–±–µ—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã';
            typeBadge.textContent = '–î–µ–±–µ—Ç–æ–≤–∞—è';
            typeInputs.forEach(i => { i.checked = (i.value === 'debit'); });
            break;
        case 'credit':
            title.textContent = '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã';
            typeBadge.textContent = '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è';
            typeInputs.forEach(i => { i.checked = (i.value === 'credit'); });
            break;
        case 'premium':
            title.textContent = '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø—Ä–µ–º–∏—É–º –∫–∞—Ä—Ç—ã';
            break;
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º UI —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞
    if (typeof updateCardTypeUI === 'function') {
        updateCardTypeUI();
    }

    modal.classList.add('modal-open');
}

function closeCardModal() {
    document.getElementById('cardModal').classList.remove('modal-open');
}

// —É–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Å–º–µ–Ω–∞ PIN

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
document.getElementById('cardForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    const payload = {
        card_type: formData.get('card_type'),
        initial_amount: formData.get('initial_amount'),
        credit_initial: formData.get('credit_initial')
    };

    // –ü–æ–ª—É—á–∞–µ–º CSRF —Ç–æ–∫–µ–Ω –∏–∑ cookie
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
    const csrfToken = getCookie('csrftoken');

    try {
        const resp = await fetch('{% url "create_card" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(payload)
        });
        const data = await resp.json();
        if (data.success) {
            showAlert('–ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø—É—â–µ–Ω–∞', 'success');
            // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É
            window.location.reload();
        } else {
            showAlert(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø—É—Å–∫–µ –∫–∞—Ä—Ç—ã', 'error');
        }
    } catch (err) {
        showAlert('–°–±–æ–π —Å–µ—Ç–∏ –ø—Ä–∏ –≤—ã–ø—É—Å–∫–µ –∫–∞—Ä—Ç—ã', 'error');
    }
});

// –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è UI –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ç–∏–ø—É –∫–∞—Ä—Ç—ã
function updateCardTypeUI() {
    const selected = document.querySelector('input[name="card_type"]:checked');
    const value = selected ? selected.value : 'debit';
    const badge = document.getElementById('previewCardType');
    const amountLabel = document.getElementById('amountLabel');
    const amountDescription = document.getElementById('amountDescription');
    const initialRange = document.getElementById('initialAmountRange');
    const initialValue = document.getElementById('initialAmountValue');
    const previewAmount = document.getElementById('previewAmount');

    badge.textContent = value === 'credit' ? '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è' : '–î–µ–±–µ—Ç–æ–≤–∞—è';
    
    if (value === 'credit') {
        amountLabel.textContent = '–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–∞ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç–µ';
        amountDescription.textContent = '–ë—É–¥–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω–∞ –Ω–∞ –Ω–æ–≤—É—é –∫—Ä–µ–¥–∏—Ç–Ω—É—é –∫–∞—Ä—Ç—É';
    } else {
        amountLabel.textContent = '–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–∞ –∫–∞—Ä—Ç–µ';
        amountDescription.textContent = '–°—É–º–º–∞ –±—É–¥–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω–∞ –Ω–∞ –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏';
    }
    
    if (initialRange && initialValue) {
        initialRange.value = initialRange.value || 0;
        initialValue.textContent = `${Number(initialRange.value).toLocaleString('ru-RU')} ‚ÇΩ`;
        previewAmount.textContent = `${Number(initialRange.value).toLocaleString('ru-RU')} ‚ÇΩ`;
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã
document.querySelectorAll('input[name="card_type"]').forEach(r => {
    r.addEventListener('change', function() {
        updateCardTypeUI();
    });
});

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–≥—É–Ω–∫–∞ —Å—É–º–º—ã –∫—Ä–µ–¥–∏—Ç–∞
document.getElementById('creditInitialRange')?.addEventListener('input', function() {
    const v = Number(this.value || 0);
    const out = document.getElementById('creditInitialValue');
    const preview = document.getElementById('previewAmount');
    if (out) out.textContent = `${v.toLocaleString('ru-RU')} ‚ÇΩ`;
    if (preview) preview.textContent = `${v.toLocaleString('ru-RU')} ‚ÇΩ`;
});

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–≥—É–Ω–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—É–º–º—ã
document.getElementById('initialAmountRange')?.addEventListener('input', function() {
    const v = Number(this.value || 0);
    const out = document.getElementById('initialAmountValue');
    const preview = document.getElementById('previewAmount');
    if (out) out.textContent = `${v.toLocaleString('ru-RU')} ‚ÇΩ`;
    if (preview) preview.textContent = `${v.toLocaleString('ru-RU')} ‚ÇΩ`;
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ
document.querySelectorAll('input[name="delivery"]').forEach(r => {
    r.addEventListener('change', function() {
        const preview = document.getElementById('previewDelivery');
        if (preview) {
            preview.textContent = this.value === 'office' ? '–í –æ—Ñ–∏—Å' : '–ö—É—Ä—å–µ—Ä–æ–º';
        }
    });
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    updateCardTypeUI();
});
</script>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã -->
<div id="cardModal" class="modal">
    <div class="modal-box max-w-3xl w-full">
        <h3 class="font-bold text-xl mb-2" id="cardModalTitle">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–µ–±–µ—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã</h3>
        <p class="text-base-content/70 mb-6">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
        <form id="cardForm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <div class="form-control mb-5">
                        <label class="label"><span class="label-text">–¢–∏–ø –∫–∞—Ä—Ç—ã</span></label>
                        <div class="join w-full">
                            <input class="btn join-item" type="radio" name="card_type" value="debit" aria-label="–î–µ–±–µ—Ç–æ–≤–∞—è" checked>
                            <input class="btn join-item" type="radio" name="card_type" value="credit" aria-label="–ö—Ä–µ–¥–∏—Ç–Ω–∞—è">
                        </div>
                        <label class="label"><span class="label-text-alt">–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π</span></label>
                    </div>

                    <div class="form-control mb-5">
                        <label class="label"><span class="label-text" id="amountLabel">–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–∞ –∫–∞—Ä—Ç–µ</span></label>
                        <input id="initialAmountRange" type="range" min="0" max="1000000" step="1000" value="0" class="range range-primary" name="initial_amount">
                        <div class="flex justify-between text-sm px-2 mt-2">
                            <span class="text-gray-500">0 ‚ÇΩ</span>
                            <span class="font-bold text-primary text-lg" id="initialAmountValue">0 ‚ÇΩ</span>
                            <span class="text-gray-500">1 000 000 ‚ÇΩ</span>
                        </div>
                        <label class="label"><span class="label-text-alt" id="amountDescription">–°—É–º–º–∞ –±—É–¥–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω–∞ –Ω–∞ –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏</span></label>
                    </div>

                    <div class="form-control mb-5">
                        <label class="label"><span class="label-text">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</span></label>
                        <div class="filter w-full">
                            <input class="btn" type="radio" name="delivery" value="office" aria-label="–í –æ—Ñ–∏—Å" required>
                            <input class="btn" type="radio" name="delivery" value="courier" aria-label="–ö—É—Ä—å–µ—Ä–æ–º">
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card bg-base-100 shadow">
                        <div class="card-body">
                            <h4 class="card-title text-base">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm">–¢–∏–ø –∫–∞—Ä—Ç—ã:</span>
                                    <span class="font-semibold" id="previewCardType">–î–µ–±–µ—Ç–æ–≤–∞—è</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm">–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞:</span>
                                    <span class="font-semibold" id="previewAmount">0 ‚ÇΩ</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
                                    <span class="font-semibold" id="previewDelivery">‚Äî</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-end gap-2 mt-6">
                        <button type="button" class="btn btn-ghost" onclick="closeCardModal()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç—ã
async function setPrimaryCard(cardId) {
    try {
        const response = await fetch(`/card/${cardId}/set-primary/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
            },
        });
        
        const data = await response.json();
        
        if (data.success) {
            showAlert(data.message, 'success');
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showAlert(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç—ã', 'error');
        }
    } catch (error) {
        showAlert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç—ã', 'error');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showAlert(message, type = 'info') {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const alert = document.createElement('div');
    alert.className = `alert alert-${type} fixed top-4 right-4 z-50 max-w-sm`;
    alert.innerHTML = `
        <div class="flex items-center">
            <span>${message}</span>
            <button class="btn btn-sm btn-ghost ml-2" onclick="this.parentElement.parentElement.remove()">√ó</button>
        </div>
    `;
    
    document.body.appendChild(alert);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        if (alert.parentElement) {
            alert.remove();
        }
    }, 5000);
}
</script>

{% endblock %}