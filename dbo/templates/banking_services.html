{% extends 'base.html' %}

{% block title %}–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —É—Å–ª—É–≥ - –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–±–∞–Ω–∫ "–§–∏–Ω–∞–Ω—Å–ü—Ä–æ"{% endblock %}

{% block content %}
{% csrf_token %}
<div class="min-h-screen bg-gradient-to-br from-base-100 to-base-200">
    <!-- Hero Section -->
    <div class="hero bg-gradient-to-r from-primary to-secondary text-primary-content py-16">
        <div class="hero-content text-center">
            <div class="max-w-4xl">
                <h1 class="text-5xl font-bold mb-6">–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —É—Å–ª—É–≥</h1>
                <p class="text-xl mb-8 opacity-90">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –ø–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —É—Å–ª—É–≥. 
                    –í—ã–±–∏—Ä–∞–π—Ç–µ, —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –∏ –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ —É—Å–ª—É–≥–∏ –æ–Ω–ª–∞–π–Ω.
                </p>
                
                <div class="stats stats-horizontal bg-base-100 text-base-content shadow-lg">
                    <div class="stat">
                        <div class="stat-title">–î–æ—Å—Ç—É–ø–Ω–æ —É—Å–ª—É–≥</div>
                        <div class="stat-value text-primary">{{ total_services }}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                        <div class="stat-value text-secondary">{{ categories|length }}</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö</div>
                        <div class="stat-value text-accent">{{ free_services }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ GET) -->
        <div class="card bg-base-100 shadow-xl mb-8 border border-base-300">
            <div class="card-body p-6">
                <form method="get" action="{% url 'banking_services' %}" class="space-y-4">
                    <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã -->
                    {% if category_active %}
                    <input type="hidden" name="category" value="{{ category_active }}">
                    {% endif %}

                    <!-- –ü–æ–∏—Å–∫ -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">–ü–æ–∏—Å–∫ —É—Å–ª—É–≥</span>
                        </label>
                        <div class="input-group">
                            <input type="text" 
                                   name="q" 
                                   value="{{ q }}" 
                                   placeholder="–ü–æ–∏—Å–∫ —É—Å–ª—É–≥..." 
                                   class="input input-bordered flex-1"
                                   id="searchInput">
                            <button type="submit" class="btn btn-square">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- –§–∏–ª—å—Ç—Ä—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">–¶–µ–Ω–∞</span>
                            </label>
                            <select name="price" class="select select-bordered w-full">
                                <option value="all" {% if price == 'all' %}selected{% endif %}>üí∞ –õ—é–±–∞—è —Ü–µ–Ω–∞</option>
                                <option value="free" {% if price == 'free' %}selected{% endif %}>üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω–æ</option>
                                <option value="low" {% if price == 'low' %}selected{% endif %}>üíµ –î–æ 1000 ‚ÇΩ</option>
                                <option value="medium" {% if price == 'medium' %}selected{% endif %}>üí∂ 1000-5000 ‚ÇΩ</option>
                                <option value="high" {% if price == 'high' %}selected{% endif %}>üí∑ –°–≤—ã—à–µ 5000 ‚ÇΩ</option>
                            </select>
                        </div>

                        <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</span>
                            </label>
                            <select name="sort" class="select select-bordered w-full">
                                <option value="name" {% if sort == 'name' %}selected{% endif %}>üìù –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                                <option value="price-low" {% if sort == 'price-low' %}selected{% endif %}>‚¨ÜÔ∏è –¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                                <option value="price-high" {% if sort == 'price-high' %}selected{% endif %}>‚¨áÔ∏è –¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                                <option value="popular" {% if sort == 'popular' %}selected{% endif %}>‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ -->
                    <div class="flex justify-end">
                        <button type="submit" class="btn btn-primary">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            –ù–∞–π—Ç–∏ —É—Å–ª—É–≥–∏
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-base-content">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥</h2>
                {% if category_active or q or price != 'all' or sort != 'name' %}
                <a href="{% url 'banking_services' %}" class="btn btn-sm btn-ghost">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </a>
                {% endif %}
            </div>
            <div id="categoryButtons" class="flex flex-wrap gap-3">
                {% for category in categories %}
                <a href="?category={{ category.name|urlencode }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if price %}&price={{ price }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}"
                   class="btn {% if category_active == category.name %}btn-primary shadow-lg scale-105{% else %}btn-outline hover:btn-primary{% endif %} transition-all duration-200">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- –£—Å–ª—É–≥–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
        {% for category_name, services in services_by_category.items %}
        <div class="category-section mb-12" data-category="{{ category_name }}">
            <div class="flex items-center mb-6">
                <div class="divider divider-primary flex-1"></div>
                <h2 class="text-2xl font-bold text-base-content mx-4">{{ category_name }}</h2>
                <div class="divider divider-primary flex-1"></div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for service in services %}
                <div class="card bg-base-100 shadow-lg hover:shadow-xl border border-base-300 hover:border-primary transition-all duration-300 hover:-translate-y-1 group">
                    <!-- –ò–∫–æ–Ω–∫–∞-—ç–º–æ–¥–∑–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥–∏ -->
                    <figure class="px-4 pt-4">
                        <div class="w-full h-40 bg-gradient-to-br from-primary/5 to-secondary/5 rounded-lg flex items-center justify-center group-hover:from-primary/10 group-hover:to-secondary/10 transition-all duration-300">
                            {% with name=service.name|lower cat=category_name|lower %}
                                <span class="text-5xl select-none">
                                    {% if '–∏–Ω–≤–µ—Å—Ç' in name or '–∏–Ω–≤–µ—Å—Ç' in cat %}üìà{% elif '–∫—Ä–µ–¥–∏—Ç' in name or '–∏–ø–æ—Ç–µ–∫' in name or '–∫—Ä–µ–¥–∏—Ç' in cat %}üí≥{% elif '–¥–µ–ø–æ–∑–∏—Ç' in name or '–≤–∫–ª–∞–¥' in name or '–¥–µ–ø–æ–∑–∏—Ç' in cat %}üí∞{% elif '–∫–∞—Ä—Ç–∞' in name or '–∫–∞—Ä—Ç–∞' in cat %}üí≥{% elif '–ø–µ—Ä–µ–≤–æ–¥' in name or '–ø–ª–∞—Ç–µ–∂' in name or '–ø–ª–∞—Ç—ë–∂' in name or '–ø–µ—Ä–µ–≤–æ–¥' in cat or '–ø–ª–∞—Ç' in cat %}üîÅ{% elif '—Å—Ç—Ä–∞—Ö' in name or '—Å—Ç—Ä–∞—Ö' in cat %}üõ°Ô∏è{% elif '—Å—á–µ—Ç' in name or '—Å—á—ë—Ç' in name or '—Ä–∫–æ' in name or '—Å—á–µ—Ç' in cat %}üè¶{% elif '–∏–Ω—Ç–µ—Ä–Ω–µ—Ç' in name or '–º–æ–±–∏–ª' in name or '–æ–Ω–ª–∞–π–Ω' in name %}üì±{% elif 'vip' in name or '–ø—Ä–µ–º–∏—É–º' in name %}‚≠ê{% elif '–ø–æ–¥–¥–µ—Ä–∂' in name or '–∫–æ–Ω—Å—å–µ—Ä–∂' in name %}üë©‚Äçüíº{% else %}üß©{% endif %}
                                </span>
                            {% endwith %}
                        </div>
                    </figure>
                    
                    <div class="card-body p-5">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ü–µ–Ω–∞ -->
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="card-title text-base leading-tight flex-1 pr-2">{{ service.name }}</h3>
                            {% if service.price > 0 %}
                            <div class="badge badge-primary font-bold whitespace-nowrap text-xs px-2 py-1">{{ service.price|floatformat:0 }} ‚ÇΩ</div>
                            {% else %}
                            <div class="badge badge-success font-bold whitespace-nowrap text-xs px-2 py-1">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
                            {% endif %}
                        </div>
                        
                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <p class="text-sm text-base-content/70 mb-3 line-clamp-2">{{ service.description|truncatewords:12 }}</p>
                        
                        <!-- –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã -->
                        <div class="flex items-center mb-3">
                            <div class="rating rating-xs">
                                {% with rating=service.rating|default:0 %}
                                <input type="radio" class="mask mask-star-2 {% if rating >= 1 %}bg-yellow-400{% else %}bg-gray-300{% endif %}" disabled>
                                <input type="radio" class="mask mask-star-2 {% if rating >= 2 %}bg-yellow-400{% else %}bg-gray-300{% endif %}" disabled>
                                <input type="radio" class="mask mask-star-2 {% if rating >= 3 %}bg-yellow-400{% else %}bg-gray-300{% endif %}" disabled>
                                <input type="radio" class="mask mask-star-2 {% if rating >= 4 %}bg-yellow-400{% else %}bg-gray-300{% endif %}" disabled>
                                <input type="radio" class="mask mask-star-2 {% if rating >= 5 %}bg-yellow-400{% else %}bg-gray-300{% endif %}" disabled>
                                {% endwith %}
                            </div>
                            <span class="text-xs text-base-content/60 ml-2">{{ service.rating|floatformat:1|default:"0.0" }} ({{ service.rating_count|default:0 }})</span>
                        </div>
                        
                        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
                        {% if service.id in connected_services %}
                        <div class="alert alert-success py-2 mb-3">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="text-xs font-semibold">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                        </div>
                        {% endif %}
                        
                        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                        <div class="card-actions gap-2 mt-auto">
                            <a href="{% url 'service_detail' service.id %}" class="btn btn-ghost btn-xs flex-1 text-xs">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                            {% if service.id in connected_services %}
                            <button class="btn btn-error btn-xs flex-1 text-xs" onclick="disconnectService({{ service.id }}, '{{ service.name }}')">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                –û—Ç–∫–ª—é—á–∏—Ç—å
                            </button>
                            {% else %}
                            <button class="btn btn-primary btn-xs flex-1 text-xs" onclick="connectService({{ service.id }}, '{{ service.name }}')">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                –ü–æ–¥–∫–ª—é—á–∏—Ç—å
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        <!-- –ï—Å–ª–∏ –Ω–µ—Ç —É—Å–ª—É–≥ -->
        {% if not services_by_category %}
        <div class="text-center py-12">
            <div class="w-24 h-24 bg-base-300 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-12 h-12 text-base-content/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-base-content mb-2">–£—Å–ª—É–≥–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h3>
            <p class="text-base-content/70">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥–∞—Ö.</p>
        </div>
        {% endif %}
    </div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ -->
<div id="requestModal" class="modal">
    <div class="modal-box max-w-lg">
        <h3 class="font-bold text-xl mb-6">–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ —É—Å–ª—É–≥—É</h3>
        <form id="serviceRequestForm">
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</span>
                </label>
                <input type="text" id="requestServiceName" class="input input-bordered" readonly>
            </div>
            
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏</span>
                </label>
                <textarea id="requestDescription" class="textarea textarea-bordered h-24" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É—Å–ª—É–≥–µ..."></textarea>
            </div>
            
            <div class="form-control mb-6">
                <label class="label">
                    <span class="label-text font-semibold">–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</span>
                </label>
                <input type="number" id="requestPrice" class="input input-bordered" placeholder="0" min="0" step="0.01">
            </div>
            
            <div class="modal-action">
                <button type="submit" class="btn btn-primary btn-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
                </button>
                <button type="button" class="btn btn-ghost" onclick="closeRequestModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<script>
let currentServiceId = null;

// –ü–æ–∏—Å–∫ —É—Å–ª—É–≥ (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ú–æ–∏ —É—Å–ª—É–≥–∏")
function searchServices() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    
    document.querySelectorAll('.category-section .card').forEach(card => {
        const serviceName = card.querySelector('.card-title') ? card.querySelector('.card-title').textContent.toLowerCase() : '';
        const description = card.querySelector('p') ? card.querySelector('p').textContent.toLowerCase() : '';
        
        if (!searchTerm || serviceName.includes(searchTerm) || description.includes(searchTerm)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –≤–∏–¥–∏–º—ã—Ö —É—Å–ª—É–≥
    document.querySelectorAll('.category-section').forEach(section => {
        const cards = section.querySelectorAll('.card');
        let hasVisible = false;
        cards.forEach(card => {
            const display = card.style.display || '';
            if (display === '' || display === 'block') {
                hasVisible = true;
            }
        });
        
        section.style.display = hasVisible ? 'block' : 'none';
    });
}

// –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ú–æ–∏ —É—Å–ª—É–≥–∏")
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            searchServices();
        });
    }
});

// –£–¥–∞–ª–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π —É—Å–ª—É–≥–∏; —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

function requestService(serviceId) {
    currentServiceId = serviceId;
    const serviceCard = event.target.closest('.card');
    const serviceName = serviceCard.querySelector('.card-title').textContent;
    
    document.getElementById('requestServiceName').value = serviceName;
    document.getElementById('requestDescription').value = '';
    document.getElementById('requestPrice').value = '';
    
    document.getElementById('requestModal').showModal();
}

function requestServiceFromModal() {
    const serviceName = document.getElementById('modalServiceName').textContent;
    document.getElementById('requestServiceName').value = serviceName;
    document.getElementById('requestDescription').value = '';
    document.getElementById('requestPrice').value = '';
    
    document.getElementById('serviceModal').close();
    document.getElementById('requestModal').showModal();
}

function closeRequestModal() {
    document.getElementById('requestModal').close();
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —É—Å–ª—É–≥
function connectService(serviceId, serviceName) {
    confirmAction(
        `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —É—Å–ª—É–≥—É "${serviceName}"?`,
        function() {
            fetch(`/connect-service/${serviceId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('success', data.message);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    showToast('error', data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏');
            });
        }
    );
}

function disconnectService(serviceId, serviceName) {
    confirmAction(
        `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å —É—Å–ª—É–≥—É "${serviceName}"?`,
        function() {
            fetch(`/disconnect-service/${serviceId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('success', data.message);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    showToast('error', data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏');
            });
        }
    );
}

function showToast(type, message) {
    const toast = document.createElement('div');
    toast.className = 'toast toast-top toast-end';
    
    const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
    const iconPath = type === 'success' 
        ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'
        : 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z';
    
    toast.innerHTML = `
        <div class="alert ${alertClass}">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${iconPath}"></path>
            </svg>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∑–∞—è–≤–∫–∏
document.getElementById('serviceRequestForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = {
        service_id: currentServiceId,
        service_name: document.getElementById('requestServiceName').value,
        description: document.getElementById('requestDescription').value,
        price: document.getElementById('requestPrice').value || 0
    };
    
    fetch('/create_service_request/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            const toast = document.createElement('div');
            toast.className = 'toast toast-top toast-end';
            toast.innerHTML = `
                <div class="alert alert-success">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</span>
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
            
            closeRequestModal();
        } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏');
    });
});

// –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
document.getElementById('searchInput').addEventListener('input', function() {
    searchServices();
});

// –§—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —É—Å–ª—É–≥
// –£–¥–∞–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π

function connectService(serviceId) {
    confirmAction(
        '–ü–æ–¥–∫–ª—é—á–∏—Ç—å —ç—Ç—É —É—Å–ª—É–≥—É?',
        function() {
            fetch(`/connect-service/${serviceId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('success', '–£—Å–ª—É–≥–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞!');
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    showToast('error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏');
            });
        }
    );
}

function disconnectService(serviceId) {
    confirmAction(
        '–û—Ç–∫–ª—é—á–∏—Ç—å —ç—Ç—É —É—Å–ª—É–≥—É?',
        function() {
            fetch(`/disconnect-service/${serviceId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('success', '–£—Å–ª—É–≥–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞!');
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    showToast('error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏');
            });
        }
    );
}

function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = 'toast toast-top toast-end';
    toast.style.zIndex = '9999';
    
    const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-error' : 'alert-info';
    const icon = type === 'success' ? 
        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>' :
        type === 'error' ?
        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>' :
        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
    
    toast.innerHTML = `
        <div class="alert ${alertClass}">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                ${icon}
            </svg>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>
{% endblock %}
