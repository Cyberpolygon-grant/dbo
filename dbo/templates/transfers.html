{% extends "base.html" %}

{% block title %}–ü–µ—Ä–µ–≤–æ–¥—ã –∏ –ø–ª–∞—Ç–µ–∂–∏{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="hero bg-gradient-to-r from-warning to-error text-primary-content rounded-lg mb-8">
        <div class="hero-content text-center">
            <div class="max-w-md">
                <h1 class="text-4xl font-bold mb-4">–ü–µ—Ä–µ–≤–æ–¥—ã –∏ –ø–ª–∞—Ç–µ–∂–∏</h1>
                <p class="text-lg opacity-90">–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏, –æ–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥ –∏ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</p>
                <div class="badge badge-lg badge-accent mt-4">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</div>
            </div>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <!-- –ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body text-center">
                <div class="text-4xl mb-2">üí∏</div>
                <h3 class="card-title justify-center">–ü–µ—Ä–µ–≤–æ–¥</h3>
                <p class="text-sm text-base-content/70">–ú–µ–∂–¥—É —Å–≤–æ–∏–º–∏ —Å—á–µ—Ç–∞–º–∏</p>
                <div class="card-actions justify-center">
                    <button class="btn btn-primary btn-sm" onclick="openTransferModal('internal')">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body text-center">
                <div class="text-4xl mb-2">üí≥</div>
                <h3 class="card-title justify-center">–ù–∞ –∫–∞—Ä—Ç—É</h3>
                <p class="text-sm text-base-content/70">–ü–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã</p>
                <div class="card-actions justify-center">
                    <button class="btn btn-secondary btn-sm" onclick="openTransferModal('card')">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- –ü–µ—Ä–µ–≤–æ–¥ –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body text-center">
                <div class="text-4xl mb-2">üè¶</div>
                <h3 class="card-title justify-center">–ü–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º</h3>
                <p class="text-sm text-base-content/70">–í –¥—Ä—É–≥–æ–π –±–∞–Ω–∫</p>
                <div class="card-actions justify-center">
                    <button class="btn btn-accent btn-sm" onclick="openTransferModal('bank')">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                </div>
            </div>
        </div>

        <!-- –û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥ -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body text-center">
                <div class="text-4xl mb-2">‚ö°</div>
                <h3 class="card-title justify-center">–ü–ª–∞—Ç–µ–∂–∏</h3>
                <p class="text-sm text-base-content/70">–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</p>
                <div class="card-actions justify-center">
                    <button class="btn btn-info btn-sm" onclick="openPaymentModal()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
            </h2>
            
            {% if transactions %}
            <div class="overflow-x-auto">
                <table class="table table-zebra w-full">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions %}
                        <tr>
                            <td>{{ transaction.created_at|date:"d.m.Y H:i" }}</td>
                            <td>
                                <span class="badge badge-outline">
                                    {% if transaction.transaction_type == 'transfer' %}–ü–µ—Ä–µ–≤–æ–¥
                                    {% elif transaction.transaction_type == 'payment' %}–ü–ª–∞—Ç–µ–∂
                                    {% elif transaction.transaction_type == 'deposit' %}–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
                                    {% elif transaction.transaction_type == 'withdrawal' %}–°–Ω—è—Ç–∏–µ
                                    {% endif %}
                                </span>
                            </td>
                            <td>{{ transaction.description }}</td>
                            <td class="font-bold {% if transaction.transaction_type == 'deposit' %}text-success{% else %}text-error{% endif %}">
                                {% if transaction.transaction_type == 'deposit' %}+{% else %}-{% endif %}{{ transaction.amount|floatformat:2 }} ‚ÇΩ
                            </td>
                            <td>
                                {% if transaction.status == 'completed' %}
                                    <span class="badge badge-success">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                                {% elif transaction.status == 'pending' %}
                                    <span class="badge badge-warning">–û–∂–∏–¥–∞–µ—Ç</span>
                                {% elif transaction.status == 'failed' %}
                                    <span class="badge badge-error">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</span>
                                {% endif %}
                            </td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="viewTransactionDetails({{ transaction.id }})">–î–µ—Ç–∞–ª–∏</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-8">
                <svg class="w-16 h-16 mx-auto text-base-content/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h3 class="text-xl font-semibold mb-2">–û–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p class="text-base-content/70 mb-4">–°–æ–≤–µ—Ä—à–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∏–ª–∏ –ø–ª–∞—Ç–µ–∂</p>
                <button class="btn btn-primary" onclick="openTransferModal('internal')">–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥</button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="text-center p-4 hover:bg-base-200 rounded-lg cursor-pointer" onclick="payService('electricity')">
                    <div class="text-3xl mb-2">‚ö°</div>
                    <p class="text-sm font-medium">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</p>
                </div>
                <div class="text-center p-4 hover:bg-base-200 rounded-lg cursor-pointer" onclick="payService('water')">
                    <div class="text-3xl mb-2">üíß</div>
                    <p class="text-sm font-medium">–í–æ–¥–∞</p>
                </div>
                <div class="text-center p-4 hover:bg-base-200 rounded-lg cursor-pointer" onclick="payService('gas')">
                    <div class="text-3xl mb-2">üî•</div>
                    <p class="text-sm font-medium">–ì–∞–∑</p>
                </div>
                <div class="text-center p-4 hover:bg-base-200 rounded-lg cursor-pointer" onclick="payService('internet')">
                    <div class="text-3xl mb-2">üåê</div>
                    <p class="text-sm font-medium">–ò–Ω—Ç–µ—Ä–Ω–µ—Ç</p>
                </div>
                <div class="text-center p-4 hover:bg-base-200 rounded-lg cursor-pointer" onclick="payService('mobile')">
                    <div class="text-3xl mb-2">üì±</div>
                    <p class="text-sm font-medium">–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å</p>
                </div>
                <div class="text-center p-4 hover:bg-base-200 rounded-lg cursor-pointer" onclick="payService('tv')">
                    <div class="text-3xl mb-2">üì∫</div>
                    <p class="text-sm font-medium">–¢–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –®–∞–±–ª–æ–Ω—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path>
                </svg>
                –ú–æ–∏ —à–∞–±–ª–æ–Ω—ã
            </h2>
            <div class="text-center py-8">
                <svg class="w-16 h-16 mx-auto text-base-content/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path>
                </svg>
                <h3 class="text-xl font-semibold mb-2">–®–∞–±–ª–æ–Ω–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p class="text-base-content/70 mb-4">–°–æ–∑–¥–∞–π—Ç–µ —à–∞–±–ª–æ–Ω –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤</p>
                <button class="btn btn-primary" onclick="createTemplate()">–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ -->
<div id="transferModal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg mb-4" id="transferModalTitle">–ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
        <form id="transferForm">
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">–°—á–µ—Ç —Å–ø–∏—Å–∞–Ω–∏—è</span>
                </label>
                <select class="select select-bordered" name="from_account" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç</option>
                    {% for account in accounts %}
                        <option value="{{ account.id }}">{{ account.account_number }} ({{ account.balance|floatformat:0 }} ‚ÇΩ)</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞</span>
                </label>
                <input type="number" class="input input-bordered" name="amount" placeholder="1000" min="1" step="0.01" required>
            </div>
            <div class="form-control mb-4" id="recipientField">
                <label class="label">
                    <span class="label-text">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</span>
                </label>
                <input type="text" class="input input-bordered" name="recipient" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
            </div>
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞</span>
                </label>
                <textarea class="textarea textarea-bordered" name="description" placeholder="–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞" required></textarea>
            </div>
            <div class="modal-action">
                <button type="button" class="btn btn-ghost" onclick="closeTransferModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–ª–∞—Ç–µ–∂–∞ -->
<div id="paymentModal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">–û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥</h3>
        <form id="paymentForm">
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">–¢–∏–ø —É—Å–ª—É–≥–∏</span>
                </label>
                <select class="select select-bordered" name="service_type" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
                    <option value="electricity">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</option>
                    <option value="water">–í–æ–¥–∞</option>
                    <option value="gas">–ì–∞–∑</option>
                    <option value="internet">–ò–Ω—Ç–µ—Ä–Ω–µ—Ç</option>
                    <option value="mobile">–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å</option>
                    <option value="tv">–¢–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ</option>
                </select>
            </div>
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">–ù–æ–º–µ—Ä –ª–∏—Ü–µ–≤–æ–≥–æ —Å—á–µ—Ç–∞</span>
                </label>
                <input type="text" class="input input-bordered" name="account_number" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –õ–°" required>
            </div>
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ</span>
                </label>
                <input type="number" class="input input-bordered" name="amount" placeholder="1000" min="1" step="0.01" required>
            </div>
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text">–°—á–µ—Ç —Å–ø–∏—Å–∞–Ω–∏—è</span>
                </label>
                <select class="select select-bordered" name="from_account" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç</option>
                    {% for account in accounts %}
                        <option value="{{ account.id }}">{{ account.account_number }} ({{ account.balance|floatformat:0 }} ‚ÇΩ)</option>
                    {% endfor %}
                </select>
            </div>
            <div class="modal-action">
                <button type="button" class="btn btn-ghost" onclick="closePaymentModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–û–ø–ª–∞—Ç–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<script>
function openTransferModal(type) {
    const modal = document.getElementById('transferModal');
    const title = document.getElementById('transferModalTitle');
    const recipientField = document.getElementById('recipientField');
    
    switch(type) {
        case 'internal':
            title.textContent = '–ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏';
            recipientField.style.display = 'none';
            break;
        case 'card':
            title.textContent = '–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É';
            recipientField.style.display = 'block';
            recipientField.querySelector('input').placeholder = '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è';
            break;
        case 'bank':
            title.textContent = '–ü–µ—Ä–µ–≤–æ–¥ –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º';
            recipientField.style.display = 'block';
            recipientField.querySelector('input').placeholder = '–†–µ–∫–≤–∏–∑–∏—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è';
            break;
    }
    
    modal.classList.add('modal-open');
}

function closeTransferModal() {
    document.getElementById('transferModal').classList.remove('modal-open');
}

function openPaymentModal() {
    document.getElementById('paymentModal').classList.add('modal-open');
}

function closePaymentModal() {
    document.getElementById('paymentModal').classList.remove('modal-open');
}

function viewTransactionDetails(transactionId) {
    showAlert('–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ #' + transactionId, 'info');
}

function payService(serviceType) {
    const serviceNames = {
        'electricity': '–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ',
        'water': '–í–æ–¥–∞',
        'gas': '–ì–∞–∑',
        'internet': '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç',
        'mobile': '–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å',
        'tv': '–¢–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ'
    };
    
    showAlert('–û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥–∏: ' + serviceNames[serviceType], 'info');
}

function createTemplate() {
    showAlert('–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–∞', 'info');
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–≤–æ–¥–∞
document.getElementById('transferForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    
    showAlert('–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ—Å—Ç—É–ø—è—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.', 'success');
    closeTransferModal();
    this.reset();
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø–ª–∞—Ç–µ–∂–∞
document.getElementById('paymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    
    showAlert('–ü–ª–∞—Ç–µ–∂ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ö–≤–∏—Ç–∞–Ω—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ email.', 'success');
    closePaymentModal();
    this.reset();
});
</script>
{% endblock %}