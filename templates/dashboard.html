<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—à–±–æ—Ä–¥ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –î–ë–û</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-safe { background-color: #10b981; }
        .status-vulnerable { background-color: #ef4444; }
        .status-unknown { background-color: #6b7280; }
        .status-error { background-color: #f59e0b; }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üîí –î–∞—à–±–æ—Ä–¥ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –î–ë–û</h1>
            <p class="text-gray-600">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
            <p class="text-sm text-gray-500 mt-2">–¶–µ–ª–µ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: <span class="font-mono">{{ target_url }}</span></p>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex flex-wrap gap-3">
            <button onclick="checkAll()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold">
                üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ
            </button>
            <button onclick="checkXSSVulnerability()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-semibold">
                üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å
            </button>
            <button onclick="checkXSSConsequence()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-semibold">
                ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è XSS
            </button>
            <button onclick="showUploadModal()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-semibold">
                üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫–µ—Ä
            </button>
            <button onclick="refreshStatus()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-semibold">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
            </button>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- XSS –£—è–∑–≤–∏–º–æ—Å—Ç—å -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800">üõ°Ô∏è XSS –£—è–∑–≤–∏–º–æ—Å—Ç—å</h2>
                    <span id="xss-vuln-status" class="px-3 py-1 rounded-full text-white text-sm font-semibold status-unknown">
                        –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                    </span>
                </div>
                <p class="text-gray-600 mb-4">–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è XSS —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                <div class="text-sm text-gray-500 mb-2">
                    –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: <span id="xss-vuln-time">-</span>
                </div>
                <button onclick="checkXSSVulnerability()" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
                <div id="xss-vuln-details" class="mt-4 p-3 bg-gray-50 rounded text-sm font-mono text-gray-700 hidden"></div>
            </div>

            <!-- XSS –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800">‚ö†Ô∏è XSS –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è</h2>
                    <span id="xss-cons-status" class="px-3 py-1 rounded-full text-white text-sm font-semibold status-unknown">
                        –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                    </span>
                </div>
                <p class="text-gray-600 mb-4">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π XSS —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (–Ω–∞–ª–∏—á–∏–µ JS –≤ —É—Å–ª—É–≥–∞—Ö)</p>
                <div class="text-sm text-gray-500 mb-2">
                    –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: <span id="xss-cons-time">-</span>
                </div>
                <button onclick="checkXSSConsequence()" class="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
                <div id="xss-cons-details" class="mt-4 p-3 bg-gray-50 rounded text-sm font-mono text-gray-700 hidden"></div>
            </div>
        </div>

        <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —á–µ–∫–µ—Ä—ã -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-gray-800">üîß –ö–∞—Å—Ç–æ–º–Ω—ã–µ —á–µ–∫–µ—Ä—ã</h2>
                <button onclick="showUploadModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm">
                    + –ó–∞–≥—Ä—É–∑–∏—Ç—å
                </button>
            </div>
            <div id="custom-checkers" class="space-y-4">
                <p class="text-gray-500 text-center py-4">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —á–µ–∫–µ—Ä–æ–≤</p>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="uploadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —á–µ–∫–µ—Ä</h3>
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            –í—ã–±–µ—Ä–∏—Ç–µ Python —Ñ–∞–π–ª (.py)
                        </label>
                        <input type="file" name="file" accept=".py" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="text-sm text-gray-500 mb-4">
                        <p>–ß–µ–∫–µ—Ä –¥–æ–ª–∂–µ–Ω:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>–ü—Ä–∏–Ω–∏–º–∞—Ç—å URL –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏</li>
                            <li>–í–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ 0 (–±–µ–∑–æ–ø–∞—Å–Ω–æ) –∏–ª–∏ 1 (—É—è–∑–≤–∏–º–æ—Å—Ç—å)</li>
                            <li>–í—ã–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ stdout/stderr</li>
                        </ul>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                            –ó–∞–≥—Ä—É–∑–∏—Ç—å
                        </button>
                        <button type="button" onclick="hideUploadModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', () => {
            refreshStatus();
        });

        async function refreshStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/status`);
                const data = await response.json();
                updateStatusDisplay(data);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }

        function updateStatusDisplay(data) {
            // XSS –£—è–∑–≤–∏–º–æ—Å—Ç—å
            const xssVuln = data.xss_vulnerability || {};
            updateCheckerDisplay('xss-vuln', xssVuln.status, xssVuln.last_check, xssVuln.details);

            // XSS –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
            const xssCons = data.xss_consequence || {};
            updateCheckerDisplay('xss-cons', xssCons.status, xssCons.last_check, xssCons.details);

            // –ö–∞—Å—Ç–æ–º–Ω—ã–µ —á–µ–∫–µ—Ä—ã
            updateCustomCheckers(data.custom_checks || {});
        }

        function updateCheckerDisplay(prefix, status, lastCheck, details) {
            const statusEl = document.getElementById(`${prefix}-status`);
            const timeEl = document.getElementById(`${prefix}-time`);
            const detailsEl = document.getElementById(`${prefix}-details`);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            statusEl.className = `px-3 py-1 rounded-full text-white text-sm font-semibold status-${status}`;
            statusEl.textContent = getStatusText(status);

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            if (lastCheck) {
                const date = new Date(lastCheck);
                timeEl.textContent = date.toLocaleString('ru-RU');
            } else {
                timeEl.textContent = '-';
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏
            if (details) {
                detailsEl.textContent = details;
                detailsEl.classList.remove('hidden');
            } else {
                detailsEl.classList.add('hidden');
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'safe': '‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ',
                'vulnerable': 'üî¥ –£—è–∑–≤–∏–º–æ',
                'unknown': '‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                'error': '‚ö†Ô∏è –û—à–∏–±–∫–∞'
            };
            return statusMap[status] || status;
        }

        function updateCustomCheckers(checkers) {
            const container = document.getElementById('custom-checkers');
            
            if (Object.keys(checkers).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —á–µ–∫–µ—Ä–æ–≤</p>';
                return;
            }

            container.innerHTML = Object.entries(checkers).map(([name, info]) => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-semibold text-gray-800">${name}</h3>
                        <span class="px-2 py-1 rounded text-white text-xs font-semibold status-${info.status || 'unknown'}">
                            ${getStatusText(info.status || 'unknown')}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${info.last_check ? new Date(info.last_check).toLocaleString('ru-RU') : '-'}</p>
                    <div class="flex gap-2">
                        <button onclick="runChecker('${name}')" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                            –ó–∞–ø—É—Å—Ç–∏—Ç—å
                        </button>
                        <button onclick="deleteChecker('${name}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                    ${info.details ? `<div class="mt-2 p-2 bg-gray-50 rounded text-xs font-mono text-gray-700 max-h-32 overflow-y-auto">${info.details.substring(0, 500)}</div>` : ''}
                </div>
            `).join('');
        }

        async function checkXSSVulnerability() {
            const btn = event?.target || document.querySelector('button[onclick="checkXSSVulnerability()"]');
            btn.disabled = true;
            btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            try {
                const response = await fetch(`${API_BASE}/api/check/xss-vulnerability`, { method: 'POST' });
                const data = await response.json();
                refreshStatus();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å';
            }
        }

        async function checkXSSConsequence() {
            const btn = event?.target || document.querySelector('button[onclick="checkXSSConsequence()"]');
            btn.disabled = true;
            btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            try {
                const response = await fetch(`${API_BASE}/api/check/xss-consequence`, { method: 'POST' });
                const data = await response.json();
                refreshStatus();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å';
            }
        }

        async function checkAll() {
            const btn = event?.target;
            btn.disabled = true;
            btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö...';
            
            try {
                const response = await fetch(`${API_BASE}/api/check/all`, { method: 'POST' });
                const data = await response.json();
                refreshStatus();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ';
            }
        }

        async function runChecker(checkerName) {
            try {
                const response = await fetch(`${API_BASE}/api/run-checker/${checkerName}`, { method: 'POST' });
                const data = await response.json();
                refreshStatus();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —á–µ–∫–µ—Ä–∞: ' + error.message);
            }
        }

        async function deleteChecker(checkerName) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —á–µ–∫–µ—Ä "${checkerName}"?`)) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/delete-checker/${checkerName}`, { method: 'DELETE' });
                const data = await response.json();
                if (data.success) {
                    refreshStatus();
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
            }
        }

        function showUploadModal() {
            document.getElementById('uploadModal').classList.remove('hidden');
        }

        function hideUploadModal() {
            document.getElementById('uploadModal').classList.add('hidden');
            document.getElementById('uploadForm').reset();
        }

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch(`${API_BASE}/api/upload-checker`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('–ß–µ–∫–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                    hideUploadModal();
                    refreshStatus();
                } else {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
            }
        });
    </script>
</body>
</html>
